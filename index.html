<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EFT Dashboard Pro (Light)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #0b0b0b; --card: #161616; --accent: #ffae00; --text: #f0f0f0; --border: #333; }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
            overflow: hidden; 
        }
        
        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent); }
        
        /* Firefoxç”¨ */
        * { scrollbar-width: thin; scrollbar-color: #333 #000; }

        .status-bar { 
            height: 50px;
            background: #000; 
            padding: 0 20px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-bottom: 1px solid var(--border); 
            flex-shrink: 0;
            z-index: 100;
        }

        .mode-switch { display: flex; background: var(--card); padding: 4px; border-radius: 8px; }
        .mode-btn { padding: 6px 15px; border: none; border-radius: 4px; cursor: pointer; color: #666; background: transparent; transition: 0.2s; }
        .mode-btn.active { background: var(--accent); color: #000; font-weight: bold; }

        .main-content { 
            display: grid; 
            grid-template-columns: 320px 1fr; 
            flex: 1; 
            overflow: hidden; 
        }

        .sidebar { 
            border-right: 1px solid var(--border); 
            display: flex; 
            flex-direction: column; 
            background: #0f0f0f; 
            height: 100%;
            overflow: hidden;
        }

        .filter-section { padding: 15px; border-bottom: 1px solid var(--border); flex-shrink: 0; }
        input, select { width: 100%; background: var(--card); border: 1px solid var(--border); color: #fff; padding: 10px; border-radius: 6px; margin-bottom: 10px; box-sizing: border-box; outline: none; }
        input:focus, select:focus { border-color: var(--accent); }
        
        .fav-filter-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #888;
            cursor: pointer;
            margin-top: 5px;
            user-select: none;
        }
        .fav-filter-label input { width: auto !important; margin: 0 !important; cursor: pointer; }

        .item-list { 
            overflow-y: auto; 
            flex: 1; 
            min-height: 0;
        }

        .item-row { 
            padding: 12px 15px; 
            border-bottom: 1px solid #1a1a1a; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            transition: 0.1s;
        }
        .item-row:hover { background: #1a1a1a; }
        .item-row img { width: 36px; height: 36px; background: #222; border-radius: 4px; flex-shrink: 0; object-fit: contain; }
        .item-row span { font-size: 13px; flex: 1; line-height: 1.4; }
        .fav-star { color: #333; margin-left: auto; font-size: 18px; transition: 0.2s; }
        .fav-star:hover { transform: scale(1.2); }
        .fav-star.active { color: var(--accent); }

        .detail-view { padding: 30px; overflow-y: auto; position: relative; height: 100%; box-sizing: border-box; background: var(--bg); }
        .loading-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); display:none; justify-content: center; align-items: center; z-index: 50; flex-direction: column; gap: 10px; }
        
        .detail-header { display: grid; grid-template-columns: 160px 1fr; gap: 30px; margin-bottom: 30px; align-items: start; }
        .big-icon { width: 160px; height: 160px; background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 15px; object-fit: contain; box-sizing: border-box; }
        
        .stat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .stat-card { background: var(--card); padding: 15px; border-radius: 8px; border: 1px solid var(--border); text-align: center; }
        .stat-label { font-size: 12px; color: #888; margin-bottom: 5px; }
        .stat-val { font-size: 20px; font-weight: bold; color: var(--accent); }
        
        .chart-box { background: var(--card); border-radius: 12px; border: 1px solid var(--border); padding: 20px; height: 450px; margin-top: 20px; }

        @media (max-width: 900px) { 
            .main-content { grid-template-columns: 1fr; }
            .sidebar { display: none; } /* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œã¯ä»Šå¾Œæ¤œè¨ */
        }
    </style>
</head>
<body>

<div class="status-bar">
    <div class="mode-switch">
        <button id="pvpBtn" class="mode-btn active" onclick="setMode('pvp')">PvP</button>
        <button id="pveBtn" class="mode-btn" onclick="setMode('pve')">PvE</button>
    </div>
    <div style="font-size: 12px; color: #666;">æœ€çµ‚æ›´æ–°: <span id="lastUpdate" style="color:#aaa">-</span></div>
</div>

<div class="main-content">
    <div class="sidebar">
        <div class="filter-section">
            <input type="text" id="searchInput" placeholder="ã‚¢ã‚¤ãƒ†ãƒ åã‚’æ¤œç´¢..." oninput="renderList()">
            <select id="catSelect" onchange="renderList()">
                <option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒª</option>
            </select>
            <label class="fav-filter-label">
                <span>ãŠæ°—ã«å…¥ã‚Šã®ã¿</span>
                <input type="checkbox" id="favOnly" onchange="renderList()">
            </label>
        </div>
        <div id="itemList" class="item-list"></div>
    </div>

    <div class="detail-view" id="detailView" style="display:none;">
        <div id="loading" class="loading-overlay">
            <div style="font-size: 24px;">ğŸ“Š</div>
            <div>å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...</div>
        </div>
        <div class="detail-header">
            <img id="mainIcon" src="" class="big-icon">
            <div>
                <h2 id="mainName" style="margin:0 0 15px 0; font-size: 24px;">ã‚¢ã‚¤ãƒ†ãƒ å</h2>
                <div class="stat-grid">
                    <div class="stat-card">
                        <div class="stat-label">ç¾åœ¨å€¤</div>
                        <div id="curPrice" class="stat-val">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">æœŸé–“å†…æœ€é«˜</div>
                        <div id="maxPrice" class="stat-val">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">æœŸé–“å†…æœ€ä½</div>
                        <div id="minPrice" class="stat-val">-</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="chart-box"><canvas id="mainChart"></canvas></div>
    </div>
</div>

<script>
    let currentItems = []; 
    let fullHistory = [];  
    let currentMode = 'pvp';
    let chart = null;
    let favorites = JSON.parse(localStorage.getItem('eft_favs') || '[]');
    let selectedItemId = null;

    // å®Ÿãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æŠ½å‡ºã—ãŸä¸»è¦ãªæ—¥æœ¬èªã‚«ãƒ†ã‚´ãƒªãƒªã‚¹ãƒˆ
const categoryList = [
    "ã‚¢ã‚µãƒ«ãƒˆãƒ©ã‚¤ãƒ•ãƒ«", "ã‚¢ã‚µãƒ«ãƒˆã‚«ãƒ¼ãƒ“ãƒ³", "ã‚¹ãƒŠã‚¤ãƒ‘ãƒ¼ãƒ©ã‚¤ãƒ•ãƒ«", "ãƒãƒ¼ã‚¯ã‚¹ãƒãƒ³ãƒ©ã‚¤ãƒ•ãƒ«", 
    "ã‚·ãƒ§ãƒƒãƒˆã‚¬ãƒ³", "ãƒãƒ³ãƒ‰ã‚¬ãƒ³", "ã‚µãƒ–ãƒã‚·ãƒ³ã‚¬ãƒ³", "ãƒã‚·ãƒ³ã‚¬ãƒ³", "æŠ•æ“²æ­¦å™¨", "ãƒŠã‚¤ãƒ•",
    "å¼¾è–¬", "å¼¾è–¬ã‚³ãƒ³ãƒ†ãƒŠ", "ãƒã‚¬ã‚¸ãƒ³", "åŒ»ç™‚å“", "è–¬", "é£Ÿæ–™", "é£²æ–™", "ãƒãƒƒã‚¯ãƒ‘ãƒƒã‚¯", 
    "ãƒã‚§ã‚¹ãƒˆãƒªã‚°", "ã‚¢ãƒ¼ãƒãƒ¼", "ãƒ˜ãƒƒãƒ‰ãƒ•ã‚©ãƒ³", "éµ", "ã‚³ãƒ³ãƒ†ãƒŠ", "æƒ…å ±ã‚¢ã‚¤ãƒ†ãƒ "
];

// è‹±èªã§å…¥ã£ã¦ãã¦ã„ã‚‹ã‚«ãƒ†ã‚´ãƒªåã‚’æ—¥æœ¬èªã«å¤‰æ›ã™ã‚‹ãŸã‚ã®ãƒãƒƒãƒ—
// è‹±èªã®ã‚«ãƒ†ã‚´ãƒªåã‚’æ—¥æœ¬èªã«å¤‰æ›ã™ã‚‹ãƒãƒƒãƒ—ï¼ˆæ¼ã‚ŒãŒãªã„ã‚ˆã†å¼·åŒ–ï¼‰
const trans = { 
    "Mechanical Key": "éµ", "Keycard": "ã‚­ãƒ¼ã‚«ãƒ¼ãƒ‰", "Armor": "ã‚¢ãƒ¼ãƒãƒ¼",
    "Armor Plate": "ã‚¢ãƒ¼ãƒãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆ", "Headwear": "ãƒ˜ãƒƒãƒ‰ã‚¦ã‚§ã‚¢", 
    "Face Cover": "ãƒ•ã‚§ã‚¤ã‚¹ã‚«ãƒãƒ¼", "Backpack": "ãƒãƒƒã‚¯ãƒ‘ãƒƒã‚¯",
    "Tactical Rig": "ãƒã‚§ã‚¹ãƒˆãƒªã‚°", "Medical Supplies": "åŒ»ç™‚å“",
    "Medication": "è–¬", "Food": "é£Ÿæ–™", "Drink": "é£²æ–™",
    "Ammo": "å¼¾è–¬", "Ammo Container": "å¼¾è–¬ç®±",
    "Magazine": "ãƒã‚¬ã‚¸ãƒ³", "Handgun": "ãƒãƒ³ãƒ‰ã‚¬ãƒ³",
    "Assault Rifle": "ã‚¢ã‚µãƒ«ãƒˆãƒ©ã‚¤ãƒ•ãƒ«", "Shotgun": "ã‚·ãƒ§ãƒƒãƒˆã‚¬ãƒ³",
    "Grenade": "æŠ•æ“²æ­¦å™¨", "Melee": "ãƒŠã‚¤ãƒ•", "Container": "ã‚³ãƒ³ãƒ†ãƒŠ",
    "Info Item": "æƒ…å ±ã‚¢ã‚¤ãƒ†ãƒ ", "Special Item": "ç‰¹æ®Šã‚¢ã‚¤ãƒ†ãƒ ",
    "Map": "ãƒãƒƒãƒ—", "Stimulant": "æ³¨å…¥å™¨(ã‚¹ãƒ†ã‚£ãƒ )",
    "Repair Kits": "ä¿®ç†ã‚­ãƒƒãƒˆ", "Fuel": "ç‡ƒæ–™", "Auxiliary Mod": "è£œåŠ©ãƒ‘ãƒ¼ãƒ„"
};

    async function init() {
    const res = await fetch(`list-${currentMode}.json`);
    const data = await res.json();
    currentItems = data.items;
    document.getElementById('lastUpdate').innerText = new Date(data.time).toLocaleString();
    
    // --- ã“ã“ã‹ã‚‰ä¿®æ­£ï¼šã‚«ãƒ†ã‚´ãƒªã‚’å‹•çš„ã«ç”Ÿæˆ ---
    const cats = new Set();
    currentItems.forEach(i => {
        // ç¿»è¨³ãŒã‚ã‚Œã°æ—¥æœ¬èªã€ãªã‘ã‚Œã°å…ƒã®åå‰ã€ãã‚Œã‚‚ãªã‘ã‚Œã°ã€Œãã®ä»–ã€
        const cName = trans[i.category?.name] || i.category?.name || "ãã®ä»–";
        cats.add(cName);
    });
    
    const sel = document.getElementById('catSelect');
    sel.innerHTML = '<option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒª</option>';
    
    // ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ï¼ˆã‚ã„ã†ãˆãŠé †ï¼‰ã«ä¸¦ã¹ã¦ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã«è¿½åŠ 
    Array.from(cats).sort().forEach(c => {
        sel.innerHTML += `<option value="${c}">${c}</option>`;
    });
    // --- ã“ã“ã¾ã§ ---
    
    fullHistory = []; 
    renderList();

    if (selectedItemId) {
        showDetail(selectedItemId);
    }
}

    function renderList() {
        const search = document.getElementById('searchInput').value.toLowerCase();
        const cat = document.getElementById('catSelect').value;
        const favOnly = document.getElementById('favOnly').checked;
        const listDiv = document.getElementById('itemList');
        
        const filtered = currentItems.filter(i => {
            const cName = trans[i.category?.name] || i.category?.name || "ãã®ä»–";
            const isFav = favorites.includes(i.id);
            return i.name.toLowerCase().includes(search) && (!cat || cName === cat) && (!favOnly || isFav);
        });

        listDiv.innerHTML = filtered.slice(0, 100).map(i => `
            <div class="item-row" onclick="showDetail('${i.id}')">
                <img src="images/${i.id}.png" loading="lazy">
                <span>${i.name}</span>
                <span class="fav-star ${favorites.includes(i.id)?'active':''}" onclick="toggleFav('${i.id}', event)">â˜…</span>
            </div>`).join('');
    }

    async function showDetail(id) {
        selectedItemId = id;
        document.getElementById('detailView').style.display = 'block';
        
        if (fullHistory.length === 0) {
            document.getElementById('loading').style.display = 'flex';
            const res = await fetch(`data-${currentMode}.json`);
            fullHistory = await res.json();
            document.getElementById('loading').style.display = 'none';
        }

        const labels = [], prices = [];
        let itemInfo = null;

        fullHistory.forEach(entry => {
            const item = entry.items.find(i => i.id === id);
            if(item) {
                labels.push(new Date(entry.time).toLocaleString('ja-JP', {month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit'}));
                prices.push(item.lastLowPrice);
                itemInfo = item;
            }
        });

        if(!itemInfo) return;

        document.getElementById('mainIcon').src = `images/${id}.png`;
        document.getElementById('mainName').innerText = itemInfo.name;
        document.getElementById('curPrice').innerText = prices[prices.length-1].toLocaleString() + " â‚½";
        document.getElementById('maxPrice').innerText = Math.max(...prices).toLocaleString() + " â‚½";
        document.getElementById('minPrice').innerText = Math.min(...prices).toLocaleString() + " â‚½";

        if(chart) chart.destroy();
        chart = new Chart(document.getElementById('mainChart'), {
            type: 'line',
            data: { labels, datasets: [{ label: 'Price', data: prices, borderColor: '#ffae00', tension: 0.2, fill: true, backgroundColor: 'rgba(255,174,0,0.05)', pointRadius: 2 }] },
            options: { 
                responsive: true, 
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { display: false }, ticks: { color: '#666', maxRotation: 0 } },
                    y: { grid: { color: '#222' }, ticks: { color: '#666' } }
                }
            }
        });
    }

    function setMode(m) {
        currentMode = m;
        document.getElementById('pvpBtn').classList.toggle('active', m === 'pvp');
        document.getElementById('pveBtn').classList.toggle('active', m === 'pve');
        init();
    }

    function toggleFav(id, e) {
        e.stopPropagation();
        if(favorites.includes(id)) favorites = favorites.filter(f => f !== id);
        else favorites.push(id);
        localStorage.setItem('eft_favs', JSON.stringify(favorites));
        renderList();
    }

    init();
</script>
</body>
</html>
